==================== JOB STARTED ====================
Start time: 2025年 08月 11日 星期一 18:34:30 CST
Working directory: /home/fanggang_1/hk/nnunet/nnUNet
Job ID: 4634.mgt
Mon Aug 11 18:34:30 2025       
+---------------------------------------------------------------------------------------+
| NVIDIA-SMI 535.129.03             Driver Version: 535.129.03   CUDA Version: 12.2     |
|-----------------------------------------+----------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
|                                         |                      |               MIG M. |
|=========================================+======================+======================|
|   0  NVIDIA GeForce RTX 4090        Off | 00000000:34:00.0 Off |                  Off |
|  0%   38C    P8              22W / 450W |     13MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
|   1  NVIDIA GeForce RTX 4090        Off | 00000000:8E:00.0 Off |                  Off |
|  0%   32C    P8              26W / 450W |     31MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
                                                                                         
+---------------------------------------------------------------------------------------+
| Processes:                                                                            |
|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
|        ID   ID                                                             Usage      |
|=======================================================================================|
|    0   N/A  N/A      3108      G   /usr/libexec/Xorg                             4MiB |
|    1   N/A  N/A      3108      G   /usr/libexec/Xorg                             9MiB |
|    1   N/A  N/A      3198      G   /usr/bin/gnome-shell                          8MiB |
+---------------------------------------------------------------------------------------+
Running nnUNet command with real-time logging...
Mon Aug 11 18:34:30 2025       
+---------------------------------------------------------------------------------------+
| NVIDIA-SMI 535.129.03             Driver Version: 535.129.03   CUDA Version: 12.2     |
|-----------------------------------------+----------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
|                                         |                      |               MIG M. |
|=========================================+======================+======================|
|   0  NVIDIA GeForce RTX 4090        Off | 00000000:34:00.0 Off |                  Off |
|  0%   38C    P8              23W / 450W |     13MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
|   1  NVIDIA GeForce RTX 4090        Off | 00000000:8E:00.0 Off |                  Off |
|  0%   32C    P8              26W / 450W |     31MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
                                                                                         
+---------------------------------------------------------------------------------------+
| Processes:                                                                            |
|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
|        ID   ID                                                             Usage      |
|=======================================================================================|
|    0   N/A  N/A      3108      G   /usr/libexec/Xorg                             4MiB |
|    1   N/A  N/A      3108      G   /usr/libexec/Xorg                             9MiB |
|    1   N/A  N/A      3198      G   /usr/bin/gnome-shell                          8MiB |
+---------------------------------------------------------------------------------------+
架构：           x86_64
CPU 运行模式：   32-bit, 64-bit
字节序：         Little Endian
CPU:             16
在线 CPU 列表：  0-15
每个核的线程数： 1
每个座的核数：   16
座：             1
NUMA 节点：      1
厂商 ID：        GenuineIntel
CPU 系列：       6
型号：           143
型号名称：       Intel(R) Xeon(R) w5-3435X
步进：           8
CPU MHz：        3100.000
CPU 最大 MHz：   4700.0000
CPU 最小 MHz：   800.0000
BogoMIPS：       6200.00
虚拟化：         VT-x
L1d 缓存：       48K
L1i 缓存：       32K
L2 缓存：        2048K
L3 缓存：        46080K
NUMA 节点0 CPU： 0-15
标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch cpuid_fault epb cat_l3 cat_l2 cdp_l3 invpcid_single intel_ppin cdp_l2 ssbd mba ibrs ibpb stibp ibrs_enhanced tpr_shadow vnmi flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid cqm rdt_a avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb intel_pt avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local split_lock_detect avx_vnni avx512_bf16 wbnoinvd dtherm ida arat pln pts hwp hwp_act_window hwp_epp hwp_pkg_req avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg tme avx512_vpopcntdq la57 rdpid bus_lock_detect cldemote movdiri movdir64b enqcmd fsrm md_clear serialize tsxldtrk pconfig arch_lbr amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities
[nnunet.lightweight_distillation] INFO: 🎓 初始化轻量级知识蒸馏训练器
[nnunet.lightweight_trainer] INFO: 🚀 初始化 nnUNetTrainerLightweight - 启用轻量级网络架构
[nnunet.lightweight_trainer] INFO: 📊 数据集: Unknown
[nnunet.lightweight_trainer] INFO: 🔧 配置: 3d_lowres, 折: 0
[nnunet.lightweight_trainer] INFO: ⚡ 轻量级组件将自动激活: 瓶颈残差块 + 金字塔池化
[nnunet.lightweight_distillation] ERROR: ❌ 教师模型路径和检查点必须通过环境变量设置
Traceback (most recent call last):
  File "/home/fanggang_1/hk/nnunet/nnUNet/compare_model_parameters.py", line 186, in main
    lightweight_model = load_model_from_checkpoint(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/fanggang_1/hk/nnunet/nnUNet/compare_model_parameters.py", line 85, in load_model_from_checkpoint
    trainer = trainer_class(plans, configuration, fold, dataset_json, device)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/fanggang_1/hk/nnunet/nnUNet/nnunetv2/training/nnUNetTrainer/nnUNetTrainerLightweightDistillation.py", line 73, in __init__
    raise ValueError("教师模型路径和检查点必须通过环境变量设置")
ValueError: 教师模型路径和检查点必须通过环境变量设置
================================================================================
nnUNet 模型参数量对比分析
================================================================================
正在加载轻量级模型...
Checkpoint路径: /home/fanggang_1/hk/nnunet/nnUNet/nnunetv2/DATASET/nnUNet_results/Dataset015_flare25/nnUNetTrainerLightweightDistillation__nnUNetPlans__3d_lowres/fold_0/checkpoint_final.pth
Plans路径: /home/fanggang_1/hk/nnunet/nnUNet/nnunetv2/DATASET/nnUNet_results/Dataset015_flare25/nnUNetTrainerLightweightDistillation__nnUNetPlans__3d_lowres/plans.json
Using device: cuda:0

#######################################################################
Please cite the following paper when using nnU-Net:
Isensee, F., Jaeger, P. F., Kohl, S. A., Petersen, J., & Maier-Hein, K. H. (2021). nnU-Net: a self-configuring method for deep learning-based biomedical image segmentation. Nature methods, 18(2), 203-211.
#######################################################################

错误: 教师模型路径和检查点必须通过环境变量设置
Exit status: 1
End time: 2025年 08月 11日 星期一 18:34:36 CST
==================== JOB FINISHED ====================
==================== JOB STARTED ====================
Start time: 2025年 08月 11日 星期一 18:38:50 CST
Working directory: /home/fanggang_1/hk/nnunet/nnUNet
Job ID: 4635.mgt
Mon Aug 11 18:38:51 2025       
+---------------------------------------------------------------------------------------+
| NVIDIA-SMI 535.129.03             Driver Version: 535.129.03   CUDA Version: 12.2     |
|-----------------------------------------+----------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
|                                         |                      |               MIG M. |
|=========================================+======================+======================|
|   0  NVIDIA GeForce RTX 4090        Off | 00000000:34:00.0 Off |                  Off |
|  0%   38C    P8              23W / 450W |     13MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
|   1  NVIDIA GeForce RTX 4090        Off | 00000000:8E:00.0 Off |                  Off |
|  0%   32C    P8              27W / 450W |     31MiB / 24564MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
                                                                                         
+---------------------------------------------------------------------------------------+
| Processes:                                                                            |
|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
|        ID   ID                                                             Usage      |
|=======================================================================================|
|    0   N/A  N/A      3108      G   /usr/libexec/Xorg                             4MiB |
|    1   N/A  N/A      3108      G   /usr/libexec/Xorg                             9MiB |
|    1   N/A  N/A      3198      G   /usr/bin/gnome-shell                          8MiB |
+---------------------------------------------------------------------------------------+
Python version: Python 3.12.9
PyTorch version: 2.6.0+cu124
==================== 二次蒸馏环境验证 ====================
教师模型路径: /home/fanggang_1/hk/nnunet/nnUNet/nnunetv2/DATASET/nnUNet_results/Dataset015_flare25/nnUNetTrainerLightweightDistillation__nnUNetPlans__3d_lowres/fold_0/checkpoint_final.pth
4层学生Plans: nnUNetPlans
蒸馏温度: 2.0
蒸馏权重 α: 0.8, β: 0.2
✅ 教师模型文件存在
✅ 4层学生Plans文件存在: nnUNetPlans
   路径: /home/fanggang_1/hk/nnunet/nnUNet/nnunetv2/DATASET/nnUNet_preprocessed/Dataset015_flare25/nnUNetPlans.json
===========================================================
Running nnUNet 二次蒸馏训练 with real-time logging...
================================================================================
🧮 轻量化nnUNet模型参数量直接计算
================================================================================
基于文件: nnUNetTrainerLightweightDistillation2nd + plans.json

📋 从plans.json读取的配置:
   阶段数: 4
   特征数: [16, 32, 64, 128]
   卷积层数/阶段: [1, 1, 2, 2]
   解码器卷积层数: [1, 1, 2]
   批次大小: 6
   补丁大小: [80, 128, 128]

🔍 详细参数计算:
============================================================
📈 编码器参数:
   阶段1-卷积1: 1→16, 参数: 92
   阶段1-下采样: 参数: 752
   阶段1总计: 844
   阶段2-卷积1: 16→32, 参数: 1,056
   阶段2-下采样: 参数: 2,016
   阶段2总计: 3,072
   阶段3-卷积1: 32→64, 参数: 3,136
   阶段3-卷积2: 64→64, 参数: 6,080
   阶段3-下采样: 参数: 6,080
   阶段3总计: 15,296
   阶段4-卷积1: 64→128, 参数: 10,368
   阶段4-卷积2: 128→128, 参数: 20,352
   阶段4总计: 30,720
编码器总参数: 49,932

📉 解码器参数:
   解码器阶段1: 77,568
   解码器阶段2: 20,352
   解码器阶段3: 6,320
解码器总参数: 104,240

📤 输出头参数:
   输出层: 16→14, 参数: 238
   深度监督1: 32→14, 参数: 462
   深度监督2: 64→14, 参数: 910
   深度监督3: 128→14, 参数: 1,806
深度监督总参数: 3,178

📊 标准nnUNet模型参数量估算:

================================================================================
📊 参数量对比结果
================================================================================
标准nnUNet模型:
  总参数量: 1.38M (1,377,624)

轻量化nnUNet模型 (深度可分离卷积):
  总参数量: 157.59K (157,588)

🎯 优化效果:
  参数减少因子: 8.7×
  模型压缩率: 88.6%
  参数节省: 1.22M

✅ 详细结果已保存到: /home/fanggang_1/hk/nnunet/nnUNet/lightweight_model_params_analysis.json

============================================================
📝 论文用数据摘要:
============================================================
• 轻量化模型参数量: 157.59K
• 参数减少因子: 8.7×
• 模型压缩率: 88.6%
• 架构: 4阶段深度可分离3D U-Net
• 特征通道: [16, 32, 64, 128]
================================================================================
🧮 轻量化nnUNet模型参数量直接计算
================================================================================
基于文件: nnUNetTrainerLightweightDistillation2nd + plans.json

📋 从plans.json读取的配置:
   阶段数: 4
   特征数: [16, 32, 64, 128]
   卷积层数/阶段: [1, 1, 2, 2]
   解码器卷积层数: [1, 1, 2]
   批次大小: 6
   补丁大小: [80, 128, 128]

🔍 详细参数计算:
============================================================
📈 编码器参数:
   阶段1-卷积1: 1→16, 参数: 92
   阶段1-下采样: 参数: 752
   阶段1总计: 844
   阶段2-卷积1: 16→32, 参数: 1,056
   阶段2-下采样: 参数: 2,016
   阶段2总计: 3,072
   阶段3-卷积1: 32→64, 参数: 3,136
   阶段3-卷积2: 64→64, 参数: 6,080
   阶段3-下采样: 参数: 6,080
   阶段3总计: 15,296
   阶段4-卷积1: 64→128, 参数: 10,368
   阶段4-卷积2: 128→128, 参数: 20,352
   阶段4总计: 30,720
编码器总参数: 49,932

📉 解码器参数:
   解码器阶段1: 77,568
   解码器阶段2: 20,352
   解码器阶段3: 6,320
解码器总参数: 104,240

📤 输出头参数:
   输出层: 16→14, 参数: 238
   深度监督1: 32→14, 参数: 462
   深度监督2: 64→14, 参数: 910
   深度监督3: 128→14, 参数: 1,806
深度监督总参数: 3,178

📊 标准nnUNet模型参数量估算:

================================================================================
📊 参数量对比结果
================================================================================
标准nnUNet模型:
  总参数量: 1.38M (1,377,624)

轻量化nnUNet模型 (深度可分离卷积):
  总参数量: 157.59K (157,588)

🎯 优化效果:
  参数减少因子: 8.7×
  模型压缩率: 88.6%
  参数节省: 1.22M

✅ 详细结果已保存到: /home/fanggang_1/hk/nnunet/nnUNet/lightweight_model_params_analysis.json

============================================================
📝 论文用数据摘要:
============================================================
• 轻量化模型参数量: 157.59K
• 参数减少因子: 8.7×
• 模型压缩率: 88.6%
• 架构: 4阶段深度可分离3D U-Net
• 特征通道: [16, 32, 64, 128]
Exit status: 0
Exit status: 0
End time: 2025年 08月 11日 星期一 18:38:54 CST
End time: 2025年 08月 11日 星期一 18:38:54 CST
==================== JOB FINISHED ====================
==================== JOB FINISHED ====================
